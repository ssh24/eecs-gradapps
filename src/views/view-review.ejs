<% include partials/header %>
    <% include partials/navbar %>
                <!--tables-->
                <div class="container-fluid" style="margin-top: 5px">
                        <div class="container text-center">
                            <a id="go-back" href="/roles/admin/" class="btn btn-link"><span class="glyphicon glyphicon-backward"></span> Go back to dashboard</a>
                        </div>
                        <% if (!filter) { %>
                            <a id="refresh-table" href="/roles/admin/reviews" class="btn btn-primary"><b>Refresh Current Table</b> <span class="glyphicon glyphicon-refresh"></span></a>
                        <% } else { %>
                            <a id="reset-table" href="/roles/admin/reviews" class="btn btn-primary"><span class="glyphicon glyphicon-arrow-left"></span> Load Default Table</a>
                            <a id="refresh-table" href="/roles/admin/reviews/filter" class="btn btn-primary">Refresh Current Table <span class="glyphicon glyphicon-refresh"></span></a>
                        <% } %>
                        <form id="assign-review-form" action="/roles/admin/reviews" method="POST">
                            <div class="container">
                                <h5>Assign all application for review:</h5>
                                <select id="cms" name="cms" class="form-control selectpicker" data-live-search="true" title="Pick one or more assignee" multiple data-max-options=<%= max_dom %>>
                                    <% for(var k = 0; k < cms.length; k++){ %>
                                        <option><%= cms[k]%></option>
                                    <%}%>
                                </select>
                                <button id="assign-review-btn" class="btn btn-success" style="margin-bottom: 5px"><span class="glyphicon glyphicon-ok"></span> Assign</button>
                                <h6>NB: Selected committee members will be only assigned to applications which still requires reviews to fulfill review quota.</h6>
                            </div>
                        </form>
                        <div class="table-responsive">
                            <% if (message.length > 0) { %>
                                <div id="error-message" class="alert alert-danger text-center">
                                    <%= message %>
                                </div>
                            <% } else { %>
                                <table id="review-table" class="table table-striped table-hover tablesorter">
                                        <thead id="table-head">
                                            <tr>
                                                <% for(var i = 0; i < fields.length; i++){ %>
                                                    <% if (hidden.includes(fields[i])) { %>
                                                        <% continue; %>
                                                    <% } else { %>
                                                        <% if (fields[i] === 'Actions' || fields[i] === 'Field(s) of Interest' || fields[i] === 'Preferred Professor(s)'){ %>
                                                            <th class="text-center sorter-false parser-false"><%= fields[i]%></th>
                                                        <%} else {%>
                                                            <th class="text-center"><%= fields[i]%></th>
                                                        <%}%>
                                                    <% } %>
                                                <%}%>
                                            </tr>
                                        </thead>
                                        <tbody id="table-body">
                                          <% for(var i = 0; i < apps.length; i++){ %>
                                            <tr>
                                                <% for(var j = 0; j < fields.length; j++){ %>
                                                    <% if (hidden.includes(fields[j])) { %>
                                                        <% continue; %>
                                                    <% } else { %>
                                                        <% if (fields[j] != 'Actions') { %>
                                                            <% if (fields[j] === 'Reviews Assigned' || fields[j] === 'Reviews Pending') { %>
                                                                <% if (apps[i]['Visa Status'] === 'Domestic') { %> 
                                                                    <td id="data-<%=i%>-<%=j%>" class="text-center">
                                                                        <%= apps[i][fields[j]]%>  / <%= max_dom %>
                                                                    </td>
                                                                <%} else if (apps[i]['Visa Status'] === 'Visa') { %>
                                                                    <td id="data-<%=i%>-<%=j%>" class="text-center">
                                                                        <%= apps[i][fields[j]]%>  / <%= max_visa %>
                                                                    </td>
                                                                <%} %>
                                                            <%} else { %>
                                                                <td id="data-<%=i%>-<%=j%>" class="text-center">
                                                                    <%= apps[i][fields[j]]%>
                                                                </td>
                                                            <%} %>
                                                        <% } else { %>
                                                            <td class="text-center">
                                                                <form id="review-form-<%=i%>" action="/roles/admin/reviews" method="POST">
                                                                    <% if(apps[i]['Visa Status'] === 'Domestic' && apps[i]['Reviews Assigned'] != max_dom) { %> 
                                                                        <select id="cms" name="cms" class="form-control selectpicker" data-live-search="true" title="Pick one or more assignee" multiple data-max-options= <%= max_dom - apps[i]['Reviews Assigned'] %> >
                                                                            <% for(var k = 0; k < cms.length; k++){ %>
                                                                                <option><%= cms[k]%></option>
                                                                            <%}%>
                                                                        </select>
                                                                        <button id="assign-review-<%=i%>" name="appId" value="<%= apps[i]['app_Id'] %>" class="btn btn-success" style="margin-bottom: 5px"><span class="glyphicon glyphicon-ok"></span> Assign</button>
                                                                    <% } else if ((apps[i]['Visa Status'] === 'Visa' && apps[i]['Reviews Assigned'] != max_visa)) { %>
                                                                        <select id="cms" name="cms" class="form-control selectpicker" data-live-search="true" title="Pick one or more assignee" multiple data-max-options= <%= max_visa - apps[i]['Reviews Assigned'] %>>
                                                                            <% for(var k = 0; k < cms.length; k++){ %>
                                                                                <option><%= cms[k]%></option>
                                                                            <%}%>
                                                                        </select>
                                                                        <button id="assign-review-<%=i%>" name="appId" value="<%= apps[i]['app_Id'] %>" class="btn btn-success" style="margin-bottom: 5px"><span class="glyphicon glyphicon-ok"></span> Assign</button>
                                                                    <% } %>
                                                                </form>
                                                                    <% if (apps[i]['Reviews Assigned'] > 0) { %>
                                                                        <a id="manage-review-<%=i%>" href="/roles/admin/reviews/manage?appId=<%= apps[i][fields[0]]%>" class="btn btn-primary" style="margin-bottom: 5px">Manage Reviews &raquo;</a></li>
                                                                    <% } %>
                                                                    <a id="view-app-<%=i%>" href="/roles/admin/reviews/view?appId=<%= apps[i][fields[0]] %>" target="_blank" class="btn btn-primary" style="margin-bottom: 5px">View Application PDF &raquo;</a></li>
                                                            </td>
                                                        <% } %>
                                                    <% } %>
                                                <% } %>
                                            </tr>
                                            <% } %>
                                        </tbody>
                                    </table>
                            <% } %>
                        </div>
                    </div>
    </div>
<% include partials/footer %>
